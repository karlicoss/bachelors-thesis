\chapter{Описание реализованного подхода}
\label{chapter2}

\section{Модель двумерного волновода с прямоугольным резонатором}
В данной работе будет анализироваться модель волновода следующего вида:
\begin{figure}[h!]
\begin{tikzpicture}[scale=0.7]
\input{pic/resonator.tex}
\end{tikzpicture}
\caption{Модель двумерного волновода с резонатором}
\end{figure}

\begin{ilist}
# область волновода $\Omega_W$ бесконечна по координате $x$ в обоих направлениях, и имеет ширину $H$;
# область резонатора $\Omega_R$ имеет размеры $L_x \times L_y$;
# резонатор и волновод соединены небольшим отверстием ширины $S$, которое симметрично относительно стенок резонатора;
# в левую часть волновода на определенной моде поступает входящая волна $\psi_{inc}$;
# на стенках волновода и резонатора $\Gamma_W, \Gamma_R$ стоит условие Дирихле: $\eval{\psi}_{\Gamma_W} = 0$, $\eval{\psi}_{\Gamma_R} = 0$, которое означает, что частицы не проникают за внешние стенки.
\end{ilist}

Целью работы является решение уравнения Шредингера для данной системы: $-\laplacian \psi = E \psi$, которое будем решать в виде уравнения Гельмгольца: $(\laplacian + E) \psi = 0$, получение ее спектральных характеристик, в частности, резонансов и построение зависимости проводимости от геометрии резонатора. Как уже было сказано во введении, для данной задачи не известны аналитические решения, и получение численных решений также представляет из себя значительную трудность.

Далее зафиксируем начало координат в точке, в которой находится центр отверстия $(x_0, y_0)$, то есть, $x_0 = 0, y_0 = 0$. В таких координатах: $\Omega_R = [- \frac{L_x}{2}, \frac{L_x}{2}] \times [0, L_y]$, $\Omega_W = [-\infty, \infty] \times [-H, 0]$.

\section{Собственные состояния, энергии и функции Грина областей задачи}
Для дальнейших расчетов понадобятся решения следующих задач:

\subsection{Одномерная яма с бесконечными стенками}
Пусть доменом является $\Omega = [a, b]$ с условиями Дирихле: $\psi(a) = 0, \psi(b) = 0$. Обозначим $L = b - a$, тогда широко известно, что для этой задачи:
\begin{ilist}
# волновые векторы: $\vb{k_n} = \frac{\pi n}{L} \vb{\hat{x}}$, $n \in \bbN^+$;
# собственные энергии: $E_n = k_n^2$, чисто дискретный спектр;
# собственные состояния в координатном представлении: $\psi_n(x) = \sqrt{\frac{2}{L}} \sin(k_n (x - a))$;
# функция Грина в спектральном разложении выглядит как:
\[
G(x, s; E) = \frac{2}{L} \sum\limits_{n = 1}^\infty \frac{\sin(\frac{\pi n}{L} x) \sin(\frac{\pi n}{L} s)}{E_n - E}
\]
, что допускает замкнутый вид:
\[
G_{1D}(x, s; E) = -\begin{cases}
\frac{\sin(k(x - a)) \sin(k(s - b))}{k \sin(k(b - a))}, & x < s \\
\frac{\sin(k(x - b)) \sin(k(s - a))}{k \sin(k(b - a))}, & x > s \\
\end{cases}
\]
, где $k = \sqrt{E}$, в случае $E < 0$ выбирается ветка квадратного корня, в которой $\Im z > 0$.
% TODO массу бы...
% (from ex\_8370\_sol\_Y11.pdf):
% тут вроде все ок со знаком и константой
\end{ilist}

\subsection{Одномерная свободная частица}
Пусть доменом является $\Omega = (-\infty, \infty)$. Широко известно, что:
\begin{ilist}
# волновые векторы: $\vb{k_{p}} = p \vb{\hat{x}}$, $p \in \bbR$;
# собственные энергии: $E_p = p^2$, имеем чисто непрерывный спектр;
# собственные состояния в координатном представлении: $\psi_p(x) = \frac{1}{\sqrt{2 \pi \hbar}} e^{\iu k_p x}$;
# функция Грина в спектральном разложении:
\[
G(x, s; E) = \int\limits_{p = -\infty}^\infty \frac{1}{2 \pi \hbar} \frac{e^{\iu p x} e^{-\iu p s}}{E_p - E} \dd{p}
\]
Данный интеграл допускает замкнутое представление:
\[
G(x, s; E) = \frac{\iu}{2 k} e^{\iu k |x - s|}
\]
, где $k = \sqrt{E}$, в случае $E < 0$ выбирается ветка квадратного корня, в которой $\Im z > 0$.
\end{ilist}

\subsection{Двумерная яма с бесконечными стенками}
Пусть доменом является $\Omega = [a_x, b_x] \times [a_y, b_y]$ с условиями Дирихле на границе: $\eval{\psi}_{\Gamma} = 0$. Данная задача соответствует области резонатора $\Omega_R$.

Для решения уравнения Шредингера разделим переменные, после чего получим уравнения:
\begin{ilist}
# $-\laplacian \psi^x(x) = E^x \psi(x)$;
# $-\laplacian \psi^y(y) = E^y \psi(y)$;
# $E^x + E^y = E$.
\end{ilist}
Эти уравнения соответствуют уже известным уравнениям для одномерной ямы с бесконечными стенками, они определяют полные системы одномерных собственных функций $\{\psi^x_n\}_n$ в $[a_x, b_x]$ и $\{\psi^y_m\}_m$ в $[a_y, b_y]$. Известно, что система функций $\psi_{n, m}(x, y) = \psi_n^x(x) \psi_m^y(y)$ в таком случае тоже будет полной системой функций в $[a_x, b_x] \times [a_y, b_y]$, значит, разделение переменных порождает все решения. Таким образом, получили:

\begin{ilist}
# волновые векторы: $k_{n, m} = \frac{\pi n}{L_x} \vb{\hat{x}} + \frac{\pi m}{L_y} \vb{\hat{y}}, n \in \bbN^+, m \in \bbN^+$;
# собственные энергии: $E_{n, m} = k_{n, m}^2$, чисто дискретный спектр;
# собственные состояния в координатном представлении: $\psi_{n, m}(x, y) = \sqrt{\frac{4}{L_x L_y}} \sin(k^x_n (x - a_x)) \sin(k^y_m (y - a_y))$
# функция Грина в спектральном разложении выглядит как:
\begin{align*}
& G(x, y, x_s, y_s; E) \\
& = \frac{4}{L_x L_y} \sum\limits_{n, m} \frac{\sin(k^x_n (x - a_x)) \sin(k^y_m (y - a_y)) \sin(k^x_n (x_s - a_x)) \sin(k^y_m (y_s - a_y))}{E_{n, m} - E}
\end{align*}
\end{ilist}

\subsection{Бесконечная квазиодномерная полоса с бесконечными стенками}
Пусть доменом является $\Omega = [-\infty; +\infty] \times [a, b]$ с условием Дирихле на границе: $\eval{\psi}_{\Gamma} = 0$. Данная задача соответствует области волновода $\Omega_W$.

Для решения уравнения Шредингера разделим переменные, после чего получим уравнения:
\begin{ilist}
# $\laplacian \psi^x(x) = E^x \psi(x)$;
# $\laplacian \psi^y(y) = E^y \psi(y)$;
# $E^x + E^y = E$.
\end{ilist}
По координате $x$ получаем уравнение, соответствующие одномерной свободной частице, по координате $y$ — уравнения для одномерной ямы с бесконечными стенками. Решения каждой из них опредяют полные системы функций, значит, разделение переменных порождает все решения. Таким образом:
\begin{ilist}
# волновые векторы: $k_{p, m} = p \vb{\hat{x}} + \frac{\pi m}{L_y} \vb{\hat{y}}, p \in \bbR, m \in \bbN^+$;
# собственные энергии: $E_{p, m} = k_{p, m}^2$;
# собственные состояния в координатном представлении: $\psi_{p, m}(x, y) = \sqrt{\frac{2}{L_y}} e^{\iu p x} \sin(k^y_m y)$
# функция Грина в спектральном разложении выглядит как: 
\[
G(x, y, x_s, y_s; E) = \int\limits_p \sum\limits_m N_p^2 N_m^2 \frac{e^{\iu p x} e^{-\iu p x_s} \sin(k_m y) \sin(k_m y_s)}{E_{p, m} - E}
\]
\end{ilist}
Интересной особенностью данной задачи является то, что ее спектр состоит из непрерывного спектра по измерению $x$ и дискретного спектра по измерению $y$. В частности, для энергии $E$ собственное подпространство в общем случае вырожденное, и подпространство решений задается произвольными коэффициентами $R_m, L_m$:
\begin{align*}
\psi(x, y)
& = \sum\limits_{m = 1}^{\frac{\pi^2 m^2}{L_y^2} < E} R_m \sin(\frac{\pi m}{L_y} y) e^{\iu \sqrt{E - \pi^2 m^2 / L_y^2} x} \\
& + \sum\limits_{m = 1}^{\frac{\pi^2 m^2}{L_y^2} < E} L_m \sin(\frac{\pi m}{L_y} y) e^{-\iu \sqrt{E - \pi^2 m^2 / L_y^2} x}
\end{align*}
, где коэффициенты $R_m$ соответствуют волнам, распространяющимся вправо, а $L_m$ — волнам, распространяющимся влево, можно видеть, что при достаточно высоких значениях энергии в волноводе может распространяться несколько независимых волн на разных модах. Более того, входящая на определенной моде волна может быть рассеянной на моде с меньшим или большим номером, что представляет собой основную трудность при постановке граничных условий для численного решения.

\section{Асимптотика производной функции Грина в окрестности отверстия}
Для дальнейших расчетов понадобится асимптотика производной функции Грина по направлению нормали к границе между резонатором и волноводом. Для того, чтобы получить асимптотику функции Грина оператора Гельмгольца у плоской поверхности с условием Дирихле, воспользуемся методом изображений. Выражение функции Грина для уравнения Гельмгольца $(\laplacian + k^2) \psi = 0$ в свободном пространстве хорошо известно:
\[
G_F(\vb{x}, \vb{s}; k) = \frac{i}{4} \hank{0}(k |\vb{x} - \vb{s}|)
\],
где $\hank{0}$ — нулевая функция Ханкеля первого рода \cite{hankel_first_kind}.

Чтобы найти асимптотику производной функции Грина по нормали, сначала найдем асимптотику функцию Грина в окрестности отверстия с источником в окрестности отверстия. Зафиксируем $x_s = 0$, и пусть $y_s$ находится близко к $0$, тогда:
% \todo{картиночку с изображениями?}
\begin{align*}
G(x, y, 0, y_s; k)
&= G_F(x, y, 0, y_s) \\
&- G_F(x, y, 0, -y_s) \\
&+ \text{оставшиеся изображения, дающие малый вклад}
\end{align*}
Вкладом остальных изображений можно пренебречь, так как значительное влияние будут оказывать только эти два члена. Возьмем производную $G$ по $y_s$, воспользовавшись тем, что $\pdv{\hank{0}(z)}{z} = - \hank{1}(z)$:
\begin{align*}
\pdv{G}{y_s}
&= \frac{i}{4} \pdv{}{y_s} \left( \hank{0}(k \sqrt{x^2 + (y - y_s)^2}) - \hank{0}(k \sqrt{x^2 + (y + y_s)^2}) \right) \\
&= \frac{i}{4} \big( -\hank{1}(k \sqrt{x^2 + (y - y_s)^2}) k \frac{-2 (y - y_s)}{2 \sqrt{x^2 + (y - y_s)^2}} \\
&+ \hank{1}(k \sqrt{x^2 + (y + y_s)^2}) k \frac{2 (y + y_s)}{2 \sqrt{x^2 + (y + y_s)^2}} \big)
\end{align*}
Устремив $y_s$ к 0, получим:
\begin{align*}
\pdv{G}{y_s} (x, y, 0, 0; k)
&= \frac{i}{2} k \frac{y}{\sqrt{x^2 + y^2}} \hank{1}(k \sqrt{x^2 + y^2})
\end{align*}

Асимптотика функции Ханкеля $H_1^{(1)}$ в окрестности нуля известна:
\[
H_1^{(1)}(z) = \frac{C}{z} + D z + o(z)
\]
, где $C$ и $D$ — некоторые константы. Подставляя асимптотику функции Ханкеля в асимптотику производной функции Грина, получим:
\begin{align*}
\pdv{G}{y_s} (x, y, 0, 0; k)
&= \frac{i}{2} k \frac{y}{r} (\frac{C}{k r} + D k r + o(kr)) = \frac{i}{2} C \frac{y}{r^2} + \frac{i}{2} D k^2 y + o(r)
\end{align*} 
Можно заметить, что константа перед сингулярным членом асимптотики не зависит от $k$, нам будет важно, что асимптотика записывается в виде $\frac{A}{r} + B_k r + o(r)$. Из асимптотики видно неинтегрируемую квадратично особенность порядка $\frac{1}{r}$, которая была квадратично интегрируемой в случае условия Неймана, где особенность была порядка $\ln(\frac{1}{r})$.

\section{Построение модели с отверстием нулевой ширины}
Чтобы получить приближение спектральных характеристик и проводящих свойств данной модели, построим соответствующую ей модель с отверстием нулевой ширины. Заметим, что весь дальнейший анализ по сути сводится к определению домена оператора Гельмгольца $\laplacian + E$, поэтому вместо него можно анализировать оператор $\Delta = \laplacian$, так как прибавление вещественной константы $E$ не изменит домен оператора.

Сузим домены операторов $\Delta_R$ и $\Delta_W$ до множеств гладких функций, удовлетворяющих условию Дирихле на замыканиях границ $\Gamma_R$ и $\Gamma_W$ (то есть, в том числе, и в точке $(x_0, y_0)$), обозначим полученные операторы $\Delta_{0R}$ и $\Delta_{0W}$, оператор для всей области $\Omega$ будет их прямой суммой: $\Delta_0 = \Delta_{0R} \oplus \Delta_{0W}$, полученный оператор является симметрическим. Чтобы дать этому оператору какой-то физический смысл, надо убедиться, что можно расширить его до самосопряженного, то есть рассчитать индексы дефекта и выбрать расширение. Однако, у данного оператора индексы дефекта $(0, 0)$, то есть он существенно самосопряжен, что нам не подходит, так как из физических соображений должно существовать расширение, в котором операторы взаимодействуют. Причину зануления индексов дефекта можно видеть, рассмотрев мультипольное разложение элементов $\dom \Delta_0^*$:
\[
f(x, y) = \sum\limits_{i = 0}^\infty c_i s^i \pdv[i]{G}{n_s} (x, y, x_0, y_0; E_D) + u(x, y)
\]
, где $s$ — радиус отверстия, $E_D$ — регулярный параметр модели, $c_i \in \bbC$, $u \in W^{2, 2}$, $u$ зануляется на границах и в отверстии.
% TODO НАЙТИ ФОРМУЛУ

Так как функция Грина удовлетворяет тем же граничным условиям, что и дифференциальное уравнение, для которого она получена, то нулевое слагаемое суммы будет равно нулю. Следующий кандидат на дефектный элемент — первая производная функции Грина. Однако, она не принадлежит $\mcL^2(\Omega)$, что видно из ее асимптотики, что и является причиной зануления индексов дефекта.

Чтобы получить расширение, необходимо:
\begin{ilist}
# заменить $\mcL^2(\Omega_R), \mcL^2(\Omega_W)$ более широкими пространствами функций, в котором лежит первая производная функции Грина;
# определить оператор $\Delta$ в расширенном пространстве;
# дать интерпретацию в этом пространстве формальному условию зануления граничной формы, которое определяет возможный выбор домена расширения:
\begin{align*}
J(f, g)
& = J_R(f, g) + J_W(f, g) \\
& = (\ip{\Delta_{0R}^* f}{g} - \ip{f}{\Delta_{0R}^* g}) + (\ip{\Delta_{0W}^* f}{g} - \ip{f}{\Delta_{0W}^* g})
\end{align*}
, в частности, определить новое скалярное произведение.
\end{ilist}
В данной работе выбирается подход с выходом в понтрягинское пространство. Мы сделаем переход от гильбертова пространства $\mcL^2(\Omega_R) \dsum \mcL^2(\Omega_W)$ со скалярным произведением $\ipcdot_\Omega = \ipcdot_{\Omega_R} + \ipcdot_{\Omega_W}$ к расширенному понтрягинскому пространству $\Pi = \Pi_R \dsum \Pi_W$, которое будет содержать необходимые для расчетов функции, и в котором будет корректно определено скалярное произведение на них.

\subsection{Расчет понтрягинского пространства для резонатора}
\subsubsection{Расчет дефектного элемента}
% TODO выбор k_0: popov1989extension
% dipole solutions
Дефектный элемент $d$ — производная функции Грина по нормали в точке $x_s = x_0, y_s = y_0$, то есть для резонатора совпадает с направлением производной по $y$.

Из выражения для функции Грина:
\begin{align*}
G(x, y, x_s, y_s; E_D) = N_x^2 N_y^2 \sum\limits_{n = 1, m = 1}^\infty \frac{\sin(k_n x + \frac{\pi n}{2}) \sin(k_n x_s  + \frac{\pi n}{2}) \sin(k_m y) \sin(k_m y_s)}{E_{n, m} - E_D}
\end{align*}
, получаем выражение для дефектного элемента:
\begin{align*}
d(x, y) 
&= \eval{\pdv{G(x, y, x_s, y_s; E_D)}{n}}_{x_s = x_0 = 0, y_s = y_0 = 0} \\
&= N_x^2 N_y^2 \sum\limits_{n = 1, m = 1}^\infty \frac{\sin(k_n x + \frac{\pi n}{2}) \sin(\frac{\pi n}{2}) \sin(k_m y) k_m}{E_{n, m} - E_D} \\
& = N_x^2 N_y^2 \sum\limits_{n = 1,2, m = 1}^\infty \frac{\cos(k_n x) \sin(k_m y) k_m}{E_{n, m} - E_D}
\end{align*}


\subsubsection{Построение предпонтрягинского пространства}
В качестве обобщенного функционала, который необходимо будет учесть в модели, мы возьмем $\psi(x, y) = d(x, y)$.
В качестве оператора, на котором будет построена шкала, выберем резольвенту $Z_0 = R_0(\iu) = \frac{1}{\Delta_0 - \iu}$, как уже было упомянуто во введении, $\iu$ подходит как произвольный элемент резольвентного множества оператора $\Delta_0$ (его спектр — неотрицательные вещественные числа), поэтому оператор $Z_0$ корректно определен и будет ограниченным по определению резольвенты.

Определим порядок предпонтрягинского пространства. Для этого надо определить такое минимальное $t$, что предпонтрягинское пространство сможет учитывать элемент $\Delta_0 \psi$, который будет фигурировать в граничной форме, то есть такой, что что $Z_0^t (\Delta_0 \psi) \in \hilb{0}$, то есть что $Z_0^t (\Delta_0 \psi)$ квадратично интегрируема на $\Omega_R$.

Рассмотрим применение интегрального оператора $Z_0$:
\begin{align*}
& (Z_0 (\Delta_0 \psi))(x, y) \\
&= \int\limits_{\Omega_R} \sum\limits_{n = 1, m = 1}^\infty N_x^2 N_y^2 \frac{\sin(k_n x + \frac{\pi n}{2}) \sin(k_n x' + \frac{\pi n}{2}) \sin(k_m y) \sin(k_m y')}{k^2_n + k^2_m - \iu} \\
& N_x^2 N_y^2 \sum\limits_{n' = 1, m' = 1}^\infty \frac{(k_{n'}^2 + k_{m'}^2) \sin(k_{n'} x' + \frac{\pi n'}{2}) \sin(\frac{\pi n'}{2}) \sin(k_{m'} y') k_{m'}}{k_{n'}^2 + k_{m'}^2 - E_D} \\
&= N_x^2 N_y^2 \sum\limits_{n = 1, m = 1}^\infty \frac{(k_n^2 + k_m^2) \sin(k_n x + \frac{\pi n}{2}) \sin(\frac{\pi n}{2}) \sin(k_m y) k_m}{(k_n^2 + k_m^2 - \iu) (k_n^2 + k_m^2 - E_D)}
\end{align*}
\\ % TODO!!!!
Легко заметить, что 
\begin{align*}
(Z_0^t (\Delta_0 \psi))(x, y)
&= N_x^2 N_y^2 \sum\limits_{n = 1, m = 1}^\infty \frac{(k_n^2 + k_m^2) \sin(k_n x + \frac{\pi n}{2}) \sin(\frac{\pi n}{2}) \sin(k_m y) k_m}{(k_n^2 + k_m^2 - \iu)^t (k_n^2 + k_m^2 - E_D)} \\
&= N_x^2 N_y^2 \sum\limits_{n = 1,2, m = 1}^\infty \frac{(k_n^2 + k_m^2) \cos(k_n x) \sin(k_m y) k_m}{(k_n^2 + k_m^2 - \iu)^t (k_n^2 + k_m^2 - E_D)}
\end{align*}

Тогда норма обобщенного элемента будет равна:
\begin{align*}
& \ip{Z_0^t (\Delta_0 \psi)}{Z_0^t (\Delta_0 \psi)} = \int\limits_{\Omega_R} \cconj{Z_0^t (\Delta_0 \psi)(x, y))} Z_0^t (\Delta_0 \psi)(x, y) \dd{x} \dd{y} \\
&\propto \sum\limits_{n = 1,2, m = 1}^\infty \frac{(n^2 + m^2) m}{\cconj{(n^2 + m^2 - \iu)^t (n^2 + m^2 - E_D)}} \frac{(n^2 + m^2) m}{(n^2 + m^2 - \iu)^t (n^2 + m^2 - E_D)} \\
&= \sum\limits_{n = 1,2, m = 1}^\infty \frac{(n^2 + m^2)^2 m^2}{(n^2 + m^2)^{2} + 1)^t (n^2 + m^2 - E_D)^2} 
\end{align*}

Для исследования сходимости данного ряда воспользуемся интегральным признаком сходимости и перейдем в полярные координаты:
\begin{align*}
\int\limits_{r = 1}^\infty \int\limits_{\phi = 0}^{\pi / 2} \frac{r^4 r^2 \sin^2 \phi}{(r^4 + 1)^t (r^2 - E_D)^2} r \dd{r} \dd{\phi}
= \int\limits_{r = 1}^\infty \frac{r^7}{(r^4 + 1)^t (r^2 - E_D)^2} \dd{r}
\end{align*}

Минимальное $t$, для которого интеграл конечен, равно $2$, значит, $\Delta_0 \psi \in \hilb{-2}$. Пространство $\mcP$ состоит из:
\[
f(x, y) = f_\phi(x, y) + f_{1} (Z_0^2 \psi)(x, y) + f_{0} (Z_0 \psi)(x, y) + f_{-1} \psi(x, y) + f_{-2} (Z_0^{-1} \psi)(x, y)
\]

Матрица $G$ для скалярного произведения:

\[
\kbordermatrix{
   & 1                        &       0 &      -1 & -2      \\
1  & \ip{}{}_0 & \ip{}{}_0 & \ip{}{}_0 & \ip{}{}_0 \\
0  & \ip{}{}_0 & \ip{}{}_0 & \ip{}{}_0 & G_{0, -2} \\
-1 & \ip{}{}_0 & \ip{}{}_0 & G_{-1,-1} & G_{-1, -2} \\
-2 & \ip{}{}_0 & G_{-2,0} & G_{-2,-1} & G_{-2,-2} \\
}
\]

Скалярные произведения для элементов $G_{i, j}$ c $i + j \ge -1$, сходятся по интегральном признаку, поэтому их можно получить непосредственно. Остальные элементы определяются следующим образом:

\begin{elist}
# зафиксируем
## $\Re G_{-1, -1} = a$;
## $\Re G_{-2, 0} = b$;
## $\Re G_{-2, -1} = c$;
## $\Re G_{-2, -2} = d$;
# $G_{-1, -1} = a = \frac{G_{-2, -1} - G_{-1, -2}}{2 \iu} = \frac{(c + \iu \Im G_{-2, -1}) - (c - \iu \Im G_{-2, -1})}{2 \iu} = \Im G_{-2, -1}$
# $G_{-1, 0} = \frac{G_{-2, 0} - G_{-1, -1}}{2 \iu} = \frac{b + \iu \Im G_{-2, 0} - a}{2 \iu}$, из чего можно выразить $\Im G_{-2, 0} = 2 G_{-1, 0} + \iu (b - a)$.
\end{elist}

После этого, воспользовавшись эрмитовой симметричностью, доопределим оставшиеся элементы. Таким образом, у нас имеется четыре свободных вещественных параметра $a, b, c, d$, которые фиксируются с помощью ренормализации расходящихся интегралов \cite{berezin1963models}.

\subsubsection{Переход в понтрягинское пространство}

Заметим, что формально:
\[
\Delta_0 \psi_j = \Delta_0 Z_0^{m + j} \psi = \Delta_0 \frac{1}{\Delta_0 - \iu} Z_0^{m + j - 1} \psi = (1 + \iu Z_0) Z_0^{m + j - 1} \psi = \psi_{j - 1} + \iu \psi_j
\]

Напомним, что нас будет интересовать скалярное произведение $\ip{\Delta f}{g}$. Надо вложить в понтрягинское пространство следующие элементы:
\begin{ilist}
# $d$: шкалы были построены на этом функционале, поэтому:
\[
d \mapsto (0; 0, 0; 1, 0)
\]
# $\Delta_\Pi d$:
\[
\Delta_\Pi d \mapsto (0; 0, 0; \iu, 1)
\]
# $u \in \dom \Delta$:
\[
u \mapsto (u; \ip{\psi_{-1}}{u}, \ip{\psi_{-2}}{u}); 0, 0)
\]
# $\Delta_\Pi u$:
\[
\Delta_\Pi u \mapsto (\Delta u; \ip{\psi_{-1}}{\Delta u}, \ip{\psi_{-2}}{\Delta u}); 0, 0)
\]
\end{ilist}
 
Распишем граничную форму $J_R(u, v) = \iip{\Delta_\Pi f}{g} - \iip{f}{\Delta_\Pi g}$. Пусть $f(x, y) = \alpha_f d(x, y) + u(x, y)$, $g(x, y) = \alpha_g d(x, y) + v(x, y)$.

\begin{align*}
f            & \xmapsto[]{\Pi} \Vector{u, \ip{\psi_{-1}}{u}, \ip{\psi_{-2}}{u}, \alpha_f, 0} \\
\Delta_\Pi f & \xmapsto[]{\Pi} \Vector{\Delta u, \ip{\psi_{-1}}{\Delta u}, \ip{\psi_{-2}}{\Delta u}, \iu \alpha_f, \alpha_f} \\
g            & \xmapsto[]{\Pi} \Vector{v, \ip{\psi_{-1}}{v}, \ip{\psi_{-2}}{v}, \alpha_g, 0} \\
\Delta_\Pi g & \xmapsto[]{\Pi} \Vector{\Delta v, \ip{\psi_{-1}}{\Delta v}, \ip{\psi_{-2}}{\Delta v}, \iu \alpha_g, \alpha_g}
\end{align*}

\begin{align*}
\iip{\Delta_\Pi f}{g}
&= \ip{\Delta u}{v} \\
&+ \cconj{\ip{\psi_{-1}}{\Delta u}} \alpha_g \\
&+ \cconj{\iu \alpha_f} \ip{\psi_{-1}}{v} + \cconj{\alpha_f} \ip{\psi_{-2}}{v} \\
&+ \cconj{\iu \alpha_f} G_{-1, -1} \alpha_g + \cconj{\alpha_f} G_{-2, -1} \alpha_g 
\end{align*}

\begin{align*}
\iip{f}{\Delta_\Pi  g}
&= \ip{u}{\Delta v} \\
&+ \cconj{\ip{\psi_{-1}}{u}} \iu \alpha_g + \cconj{\ip{\psi_{-2}}{u}} \alpha_g \\
&+ \cconj{\alpha_f} \ip{\psi_{-1}}{\Delta v} \\
&+ \cconj{\alpha_f} G_{-1, -1} \iu \alpha_g + \cconj{\alpha_f} G_{-1, -2} \alpha_g 
\end{align*}

Заметим, что
\begin{elist}
# $\ip{u}{\Delta v} - \ip{\Delta u}{v} = 0$, так как элементы $u$ и $v$ лежат в домене самосопряженного оператора $\Delta$;
# $\ip{\psi_{-1}}{\Delta u} - (\cconj{\iu} \ip{\psi_{-1}}{u} + \ip{\psi_{-2}}{u}) = \ip{\psi_{-1}}{\Delta u} - \ip{\Delta \psi_{-1}}{u}$. Непосредственно применять тождество Грина нельзя, так как в точке $0$ присутствует сингулярность. Будем считать скалярные произведения по области с выколотым полукругом радиуса $r$ и устремим $r$ к нулю. Тогда можно приметить тождество Грина, и свести интеграл к интегралу по контуру области с выколотым полукругом. Однако, данный интеграл по части контура, пересекающейся с границей $\Gamma$ будет нулевой, так как там функции удовлетворяют граничным условиях Дирихле и обращаются в ноль. Интеграл же по оставшейся части, то есть по полуокружности, равен:
\[
\int\limits_{\phi = -\pi / 2}^{\pi / 2} \left( \cconj{\psi_{-1}} \pdv{u}{r} - u \cconj{\pdv{\psi_{-1}}{r}} \right) r \dd{\phi}
\]
Подставим сюда асимптотические значения $\psi_{-1}(r) = \frac{A}{r} + B_{E_D} r + o(r)$, что уже было рассчитано ранее, $u(r) = b r + o(r)$, что видно из того, что функции удовлетворяют условию Дирихле, то есть константный член асимптотики зануляется. Получим:
\[
\int\limits_{\phi = -\pi / 2}^{\pi / 2} \left(  \cconj{\left( \frac{A}{r} + B_{E_D} r \right)} b - b r \cconj{\left( -\frac{A}{r^2} + B_{E_D} \right)} \right) r \dd{\phi} = 2 \pi \cconj{A} b
\]
Так как $A$ — чисто вещественное, получаем в итоге: $\ip{\psi_{-1}}{\Delta u} - (\cconj{\iu} \ip{\psi_{-1}}{u} + \ip{\psi_{-2}}{u}) = 2 \pi A b$.
# Для $\ip{\psi_{-1}}{\Delta v}$ поступаем аналогично предыдущему пункту.
# $\cconj{\iu} G_{-1, -1} + G_{-2, -1} - \iu G_{-1, -1} - G_{-1, -2} = 0$, что видно из зафиксированной выше параметризации скалярного произведения.
\end{elist}
В итоге, получаем:
\begin{align*}
J_R(u, v) = 2 \pi A (a_R^g \cconj{b_R^u} - \cconj{a_R^f} b_R^v)
\end{align*}

\subsection{Расчет понтрягинского пространства для волновода}
\subsubsection{Расчет дефектного элемента}
Аналогично случаю резонатора, дефектный элемент — производная функции Грина по нормали к границе, то есть, $-\pdv{G_W}{y}$.

Функция Грина:
\[
G_W(x, y, x_s, y_s; E) = \int\limits_p \sum\limits_m N_x^2 N_y^2 \frac{e^{\iu p x} e^{-\iu p x_s} \sin(k_m y) \sin(k_m y_s)}{E_{p, m} - E}
\]

\begin{align*}
d_W(x, y) = -\pdv{G_W(x, y, x_0, y_0; E_D)}{y} (x, y) = \int\limits_{p = -\infty}^\infty \sum\limits_{m = 1}^\infty N_x^2 N_y^2 \frac{e^{\iu p x} \sin(k_m y) k_m }{E_{p, m} - E}
\end{align*}

\subsubsection{Построение предпонтрягинского пространства}
Аналогично случаю резонатора, в качестве обобщенного элемента, на котором строятся шкалы, берется $\psi(x, y) = d_W(x, y)$. Рассмотрим применение $Z_0$ к $\Delta_0 \psi$:

\begin{align*}
(Z_0 (\Delta_0 \psi))(x, y)
&= \int\limits_{\Omega_W} \int\limits_p N_x^2 N_y^2 \sum\limits_m \frac{e^{\iu p x} e^{-\iu p x'} \sin(k_m y) \sin(k_m y')}{E_{p, m} - \iu} \\
&  \int\limits_{p'} \sum\limits_{m'} N_x^2 N_y^2  \frac{({p'}^2 + k_{m'}^2) e^{\iu p' x'} \sin(k_{m'} y') k_{m'} }{E_{p', m'} - E_D} \\
&= \int\limits_p \sum\limits_m N_x^2 N_y^2 \frac{(p^2 + k_m^2) e^{\iu p x} \sin(k_m y) k_m}{(E_{p, m} - \iu) (E_{p, m} - E_D)}
\end{align*}

Легко заметить, что:
\begin{align*}
(Z_0^t (\Delta_0 \psi))(x, y) =
\int\limits_p \sum\limits_m N_x^2 N_y^2  \frac{(p^2 + k_m^2) e^{\iu p x} \sin(k_m y) k_m}{(E_{p, m} - \iu)^t (E_{p, m} - E_D)}
\end{align*}

Определим порядок предпонтрягинского пространства:
\begin{align*}
\ip{Z_0^t (\Delta_0 \psi)}{Z_0^t (\Delta_0 \psi)}
&= \int\limits_{\Omega_W} \cconj{(Z_0^t (\Delta_0 \psi))(x, y)} (Z_0^t (\Delta_0 \psi))(x, y) \\
&\propto \int\limits_p \sum\limits_m \frac{(p^2 + m^2)^2 m^2}{((p^2 + m^2)^{2} + 1)^t (p^2 + m^2 - E_D)^2}
\end{align*}

Аналогично случаю резонатора, данный интеграл сходится по интегральному признаку сходимости при $t = 2$, то есть $\Delta_0 \psi \in \hilb{-2}$, пространство $\mcP$ состоит из:
\[
f(x, y) = f_\phi(x, y) + (Z_0^2 \psi)(x, y) f_1 + (Z_0 \psi)(x, y) f_0 + \psi(x, y) f_{-1} + f_{-2} (Z_0^{-1} \psi)(x, y)
\]

\subsubsection{Переход в понтрягинское пространство}
Параметризация скалярного произведения и расчеты граничной формы полностью аналогичны случаю резонатора. В итоге получаем граничную форму:
\begin{align*}
J_W(u, v) = 2 \pi A (a_W^g \cconj{b_W^u} - \cconj{a_W^f} b_W^v)
\end{align*}

\section{Расширение модели в понтрягинском пространстве}
\subsection{Фиксация расширения и получение явной формы волновой функции}

Напомним, что домен оператора в окрестности нуля состоит из элементов вида:
\[
\begin{cases}
a_R d_R(\vb{r}; E_D) + b_R r + o(r)  &, \vb{r} \in \Omega_R \\
a_W d_W(\vb{r}; E_D) + b_W r + o(r)  &, \vb{r} \in \Omega_W \\
\end{cases}
\], где $E_D$ — регулярный параметр модели. Надо зафиксировать соотношения между $a_R, a_W, b_R, b_W$, чтобы получить самосопряженное расширение. Для этого рассмотрим граничную форму в пространстве $\Pi = \Pi_R \oplus \Pi_W$:
\begin{align*}
J(f_R \oplus f_W, g_R \oplus g_W)
&= J_R(f_R, g_R) + J_W(f_W, g_W) \\
&= 2 \pi A (a_R^g \cconj{b_R^u} - \cconj{a_R^f} b_R^v  + a_W^g \cconj{b_W^u} - \cconj{a_W^f} b_W^v)  = 0
\end{align*}

Удовлетворить данное тождество можно следующим образом:
\begin{align*}
a_R &= -a_W \\
b_R &= b_W
\end{align*}
Фактически, мы сшиваем по непрерывности асимптотики несингулярных элементов домена в окрестности отверстия ($b_R = b_W$), и нулевой поток из отверстия ($a_R = -a_W$).

Решение задачи мы ищем в виде:
\[
\begin{cases}
\alpha_W d_R(\vb{r}; E) &, \vb{r} \in \Omega_R \\
\alpha_W d_W(\vb{r}; E) + u_{inc}(\vb{r})&, \vb{r} \in \Omega_W
\end{cases}
\], где $E$ — полная энергии входящей волны, и $u_{inc}$ — входящая в волновод волна. Асимптотикой такой формы решения в окрестности отверстия является:
\[
\begin{cases}
\alpha_W d_R(\vb{r}; E) &, \vb{r} \in \Omega_R \\
\alpha_W d_W(\vb{r}; E) + \pdv{u_{inc}}{n} (\vb{r}) &, \vb{r} \in \Omega_W
\end{cases}
\]
Засчет того, что сингулярный член асимптотики дефектного элемента не зависит от $E$, можем вычислить следующие величины:
\begin{ilist}
# $F_R = \lim\limits_{r \to 0} \frac{d_R(x, y; E) - d_R(x, y; E_D)}{r}$;
# $F_W = \lim\limits_{r \to 0} \frac{d_W(x, y; E) - d_W(x, y; E_D)}{r}$.
\end{ilist}

Пользуясь этим, получим:
\begin{ilist}
# $a_R = \alpha_R$
# $a_W = \alpha_W$
# $b_R = \alpha_R F_R$
# $b_W = \alpha_W F_W + \pdv{u_{inc}}{n} (\vb{0})$
\end{ilist}

Воспользовавшись условиями нашего расширения, можно выразить все через, например, $\alpha_W$, получив $-\alpha_W F_R = \alpha_W F_W  + \pdv{u_{inc}}{n} (\vb{0})$, из чего выражается:
\begin{ilist}
# $\alpha_W = \frac{-\pdv{u_{inc}}{n} (\vb{0})}{F_R + F_W}$
# $\alpha_R = - \alpha_W$
\end{ilist}

После получения решения в явном виде мы можем строить функции плотности вероятности при различных конфигурациях системы и различных энергиях.

\subsection{Расчет коэффициента прохождения}
Рассмотрим, как можно получать коэффициент прохождения: из геометрии системы ясно, что поток вероятности по координате $y$ практически отсутствует. Чтобы посчитать суммарный поток по координате $x$, надо рассчитать величину $J_x = \lim\limits_{x \to x_\infty} \int\limits_{y = -H}^0 j_x(x, y) \dd{y}$, где $x_\infty$ — некоторое асимптотическое значение, в идеале равное $\pm \infty$ (знак в зависимости от того, для входящей или прошедшей волны считается коэффициент), а при численном счете — просто некоторое большое значение. После этого, получив значения $J_{inc}, J_{trans}$ для входящей волны $\psi_{inc}$, и для прошедшей $\psi_{trans} = \alpha_W d_W + \psi_{inc}$, сможем рассчитать коэффициент прохождения $T = \frac{|J_{trans}|}{|J_{inc}|}$. Самый простой вариант — воспользоваться численным дифференцированием и интегрированием для расчета этого коэффициента, однако, и здесь можно воспользоваться явной формой полученного решения следующим образом.

Далее за $z_m$ обозначим продольное волновое число, то есть $z_m = \sqrt{E - E^W_m}$. Входящая на $m$-й моде волна имеет вид $\psi_{inc}(x, y) = \psi_m^W(y) e^{\iu z_m x}$. Ток вероятности для нее в фиксированной точке $(x, y)$ рассчитывается как:
\begin{align*}
j(x, y)
&= \cconj{\psi_{inc}(x, y)} \pdv{\psi_{inc}}{x} (x, y) - \psi_{inc}(x, y) \cconj{ \pdv{\psi_{inc}}{x} (x, y)} \\
&= \psi_m^W(y) e^{-\iu z_m x} \psi_m^W(y) (\iu z_m) e^{\iu z_m x} \\
&- \psi_m^W(y) e^{\iu z_m x} \psi_m^W(y) (-\iu z_m) e^{-\iu z_m x} \\
&= (\psi_m^W(y))^2 2 \iu z_m
\end{align*}

Легко заметить, что $J_{inc}$, равное интегралу данной величины по $y$ от $-H$ до $0$, будет равно $2 \iu z_m$, так как интеграл квадрата собственной функции $\psi_m^W$ нормирован к единице.

Выражение для прошедшей волны:
\begin{align*}
\psi_{trans}(x, y)
&= \psi_{inc}(x, y) + \alpha_W d_W(x, y; E) \\
&= \psi_m^W(y) e^{\iu z_m x} + \alpha_W \sum_{m'} \psi_{m'}^W(y) \psi_{m'}^{'W}(y_0) \frac{\iu}{2 z_{m'}} e^{i z_{m'} x}
\end{align*}

\begin{align*}
\int & \cconj{\psi_{trans}(x, y)} \pdv{\psi_{trans}}{x} (x, y) \\
\int
& (\psi_m^W(y) e^{-\iu z_m x} + \cconj{\alpha_W} \sum_{m'} \psi_{m'}^W(y) \psi_{m'}^{'W}(y_0) \frac{-\iu}{2 \cconj{z_{m'}}} e^{-i \cconj{z_{m'}} x}) \\
& (\psi_m^W(y) \iu z_m e^{\iu z_m x} + \alpha_W \sum_{m'} \psi_{m'}^W(y) \psi_{m'}^{'W}(y_0) \frac{-1}{2} e^{i z_{m'} x}) \\
&= i z_m \\
&+ \alpha_W \psi_{m}^{'W}(y_0) \frac{-1}{2} \\
&+ \iu z_m \cconj{\alpha_W} \psi_{m}^{'W}(y_0) \frac{-\iu}{2 z_{m}} \\
&+ |\alpha_W|^2 \sum_{m'} (\psi_{m'}^{'W}(y_0))^2 \frac{\iu}{4 \cconj{z_{m'}}} e^{\iu (z_{m'} - \cconj{z_{m'}}) x}
\end{align*}

\begin{align*}
\int & \psi_{trans}(x, y) \cconj{\pdv{\psi_{trans}}{x} (x, y)} \\
\int
& (\psi_m^W(y) e^{\iu z_m x} + \alpha_W \sum_{m'} \psi_{m'}^W(y) \psi_{m'}^{'W}(y_0) \frac{\iu}{2 z_{m'}} e^{i z_{m'} x}) \\
& (\psi_m^W(y) (-\iu z_m) e^{-\iu z_m x} + \cconj{\alpha_W} \sum_{m'} \psi_{m'}^W(y) \psi_{m'}^{'W}(y_0) \frac{-1}{2} e^{-i \cconj{z_{m'}} x}) \\
&= -i z_m \\
&+ \cconj{\alpha_W} \psi_{m}^{'W}(y_0) \frac{-1}{2} \\
&+ (-\iu z_m) \alpha_W \psi_{m}^{'W}(y_0) \frac{\iu}{2 z_{m}} \\
&+ |\alpha_W|^2 \sum_{m'} (\psi_{m'}^{'W}(y_0))^2 \frac{-\iu}{4 z_{m'}} e^{\iu (z_{m'} - \cconj{z_{m'}}) x}
\end{align*}

Заметим, что суммы можно разбить на суммирование по открытым каналам (энергия продольной волны положительна, $z_{m'}$ чисто вещественное) и по закрытым (энергия продольной волны отрицательна, $z_{m'}$ чисто комплексное, $\Im z_{m'} > 0$). Сумму ряда с закрытыми каналами можно оценить как $\sum\limits_{m'} (m')^2 \frac{1}{m'} e^{- (m')^2 x}$, что сходится по интегральному признаку для любого $x > 0$, и стремится к нулю при $x \to \infty$, поэтому суммирование по закрытым каналам можно откинуть, после чего получаем окончательное выражение для $J_{trans}$:
\begin{align*}
J_{trans} = 2 \iu z_m - \alpha_W \psi_m^{'W}(y_0) + \cconj{\alpha_W} \psi_m^{'W}(y_0) + |\alpha_W|^2 \sum_{m'= 1}^{E^W_{m'} < E} (\psi_{m'}^{'W}(y_0))^2 \frac{\iu}{2 z_{m'}}
\end{align*}